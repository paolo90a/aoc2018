t <- "#.|..#...|#...#...|.|....|..|...#.|...#..|.|.|.|#.
.....|.#...|....#|....||#.|###.......#.#|.##.|...|
...#|.....||..|..|||.#......#..|.#..|..|..#.....|.
..|..#.....###.#|.....|.|...##.##......|#...|##...
....###.......|...|..||...#||.##..|.|.|.#|..|.#...
|..|#......|#.|..#.#....||...|.#||....|#....#.#...
.|..#.|.|..|.#|.#|.#......#..###.|||.#.|.....#...#
..|.|.....||......|...|#....|....##.|.|..|..#.#...
.......##.#..|.|.........|...|..#|.|#.#..||#|...|.
.|###|...|.....|..#.|..|#...|.............|.......
|........##.|.#.##.|##.##..#|..#|.|..|.|....|.....
|.....#|#..#|.|..#..#|...|.#..|#.........|#....|..
..|.#........#........#..||#|.#.........#.|#||.|||
.|##...#..||.....|.|..|..|...|...|..#.....#.###|..
..#|.#|#...|#.|||#..#|#...##.|||#...#.|.|...#.|...
...|...#|..###...#.....|..|...|#..........|..|.|..
#||||.|#.##|....|..||...|##|.....|.|#||..##..||.||
.||.#..|..|||#.#.#|....#..##|#|...|.|#..||..#...#.
..#..#.||.|...|.|||.|#|..#..|.#.........|...#.#|..
|...||#.####||.......#..|#|.#|..|#..#.|....###|#|.
.|.|||.#..#..#.####.##..|#||.#..|#...|...||....|..
.....||#|...#.##........|..##...#...|..##|#.##....
..|#.|#....|##.#|#.#|..#.#......|#....###.##...#.|
..|.#....##...|||..|.#|#..|..|..||#.....#.#..#....
..|..||..##....#.......#..|......|...#.#.##...||#.
..............######|#...|###.##......#...#.|..#.|
.#..|......##..#..||###|.||....#...||..#.##.#.#.||
##.##......##.#|..|.#.#....|#|#|..|#.##|...|.||#..
|.#...##.|#|.|..|.||.|||.......##..#.#..|...##.|..
....#...#...#||.#.#..#...##.#.#...|#.#..#...|..#.|
....#....|.....||.....|.|#.|.|..||..|#........|...
..#...#...|...###.|..#.#.||||....|.....#|........|
##|#..#.#|#..|.||..||..|.||##..##|#.|.##|....#....
|.#|#||.#...#|...#...#|.##.|..##..||#.||#|......|#
|#|..|.||...#...|####...#....#|...|..#..##...|###.
....##.#.|..|......##...|#.###..#....|###.##.||##|
|..#....#..|#.........|....|....##...#....#.#..|..
.......|..|..#...#....##..#.|.#|..#..|.#.#..|||...
..##||.....#..|....|..|#.|#...#.#|....#|#..||#..|.
.#...##.#..#..#..#..|#..#.......||...#.#.|.##...|.
#..|.#.#...#.|...##|..#.#|##.......|.|..#.|#.....#
..|...#|..#|...#......#..#....|.|.#..#..|#|...#..#
.#..##.|.#.##|..##..||.....|#|.|...|..|..#.....|##
.....#...|....|..|..........##.#..|..###.||#...#|#
.#....|......#.#.#.#..#..#..|.....|..|..|.|...#..#
#|....##....###......#.|..|.#..|..|..|||.##.#....#
.|||##.||......#|.#...|......|...|...#.#..#..#..|#
|.#...#|.#|.##......##...#....|.|..|....#.||#.....
.#..|.|.|...|#..#.####|..#..###.....#.##...###.#..
.#.........|.#......|...##.#|...|.####..|...#.###|"

str_to_matrix <- function(string){
  x1 <- strsplit(string, "\n")[[1]]
  x2 <- strsplit(x1, "")
  x3 <- as.data.frame(x2)
  matrix(as.matrix(x3), ncol = ncol(x3), dimnames = NULL)
}
# lu  u  ru
# l   +  r
# ld  d  rd
find_nb <- function(point, matrix){
  x_p <- point[2]
  y_p <- point[1]
  up  <- matrix[y_p - 1, c((x_p - 1):(x_p + 1))]
  md  <- matrix[y_p, c((x_p - 1):(x_p + 1))]
  lw  <- matrix[y_p + 1, c((x_p - 1):(x_p + 1))]
  
  lu <<- up[1]
  u  <<- up[2]
  ru <<- up[3]
  l  <<- md[1]
  cc <<- md[2]
  r  <<- md[3]
  ld <<- lw[1]
  d  <<- lw[2]
  rd <<- lw[3]
  nb <<- c(lu = lu, u = u, ru = ru, l = l, cc = cc, r = r, ld = ld, d = d, rd = rd)
}

mt   <- t(str_to_matrix(t))
mt   <- rbind(".", cbind(".", mt, "."), ".")
mt_n <- mt
min  <- 0
while(min < 10){
  min <- min + 1
  mt  <- mt_n
  for(i in 2:(ncol(mt) - 1)){
    for(j in 2:(nrow(mt) - 1)){
      pt <- c(i, j)
      find_nb(pt, mt)
      # nb <- nb[!is.na(nb)]
      if(cc == "."){
        if(length(which(nb == "|")) > 2){
          cc <- "|"
        }
      }else if(cc == "|"){
        if(length(which(nb == "#")) > 2){
          cc <- "#"
        }
      }else if(cc == "#"){
        if((length(which(nb == "#")) > 1) && (length(which(nb == "|")) > 0)){
          cc <- "#"
        }else{
          cc <- "."
        }
      }
      mt_n[i, j] <- cc
    }
  }
}
lum <- length(which(mt_n == "#"))
wd  <- length(which(mt_n == "|"))
wd * lum


# 18.2 
# For this problem you have to look for a pattern
mt   <- t(str_to_matrix(t))
mt   <- rbind(".",cbind(".", mt, "."), ".")
mt_n <- mt
wd   <- NULL
lum  <- NULL
min  <- 0
while(min < 1000){
  min <- min + 1
  mt  <- mt_n
  for(i in 2:(ncol(mt) - 1)){
    for(j in 2:(nrow(mt) - 1)){
      pt <- c(i, j)
      find_nb(pt, mt)
      if(cc == "."){
        if(length(which(nb == "|")) > 2){
          cc <- "|"
        }
      }else if(cc == "|"){
        if(length(which(nb == "#")) > 2){
          cc <- "#"
        }
      }else if(cc == "#"){
        if((length(which(nb == "#")) > 1) && (length(which(nb == "|")) > 0)){
          cc <- "#"
        }else{
          cc <- "."
        }
      }
      mt_n[i, j] <- cc
    }
  }
  lum1 <- length(which(mt_n == "#"))
  wd1  <- length(which(mt_n == "|"))
  wd   <- c(wd, wd1)
  lum  <- c(lum, lum1)
}

#pattern from 404 t/m 431  (every 28 minutes it repeats)
# 1000000000 - 35714271 * 28 + 403
# 9 left, so 403 +9
wd[412] * lum[412]

